- [Part3-4장. 메모리 동적 할당](#part3-4장-메모리-동적-할당)
  - [1. 동적 할당 함수](#1-동적-할당-함수)
  - [2. 동적 할당 저장 공간의 활용](#2-동적-할당-저장-공간의-활용)

# Part3-4장. 메모리 동적 할당

## 1. 동적 할당 함수

- 동적 할당: 실행 시점에 메모리 공간 할당 → `h` 헤더 파일

  - 저장 공간 힙 영역에 할당 (쓰레기값 존재)
  - 주소만 알면 어떤 함수에서나 사용가능
  - 메모리의 사용과 반환이 불규칙적 → 연속된 큰 저장 공간 요구 시 널 포인터 반환

- `malloc` 함수: size 바이트 수 만큼 할당하고 시작 위치 반환

  - 원형: `void* malloc(unsigned int size);`
    ex) `int* p=(int*)malloc(sizeof(int));` → `(void *)`형 반환하므로 강제 형변환 하여 사용
  - 컴파일러에 따라 변수의 크기가 달라도 프로그램 수정 필요 없음
  - 주어진 인수의 바이트 크기만큼 메모리에서 연속된 저장 공간 할당 후 그 시작 주소 반환
  - 간접참조 연산 → 가리키는 저장 공간 값을 저장하거나 출력 가능
  - 원하는 크기의 공간 할당하지 못하면 0번지인 널 포인터 반환
    → 값 참조 시 오류 메시지 표시하고 비정상 종료 (간접 참조 연산 불가)

    > exit 함수: 예외 상황 발생하면 어떤 함수에서든 프로그램 바로 종료 → 인수로 1 주고 호출

- `calloc` 함수: `(cnt*size)` 바이트 수만큼 할당하고 0으로 초기화 후 시작 위치 반환

  - 원형: `void* calloc(unsigned int cnt, unsigned int size);`  
    ex) `double* p=(double*)calloc(5, sizeof(double));`

- `realloc` 함수: `p`가 연결한 영역의 크기를 size바이트의 크기로 조정하고 시작 위치 반환

  - 원형: `void* realloc(void* p, unsigned int size);`  
    ex) `char* p=(char*)realloc(p, 2*strlen(str));`
  - 저장 공간을 늘리는 경우 이미 입력한 값은 그대로 유지하고 추가된 공간에는 쓰레기값
  - 저장 공간을 줄이는 경우 입력된 데이터는 잘려나감
  - 재할당 과정에서 메모리의 위치 바뀔 수 있음 → 반환하는 주소를 다시 포인터에 저장

- `free` 함수: `p`가 연결한 영역 반환 (재활용 위해 다시 반납)
  - 원형: `void free (void* p);`
  - 동적 할당 저장 공간: 함수가 반환된 후에도 자동으로 회수 되지 않음 → 직접 반환
  - `main` 함수에서는 반환 X (프로그램 끝나면 동적 할당 부분 자동 반납)
  - 생략 시 메모리 누수 발생하거나 프로그램 강제 종료 가능성 있음

## 2. 동적 할당 저장 공간의 활용

- 입력 문자열 처리: 입력 문자열의 길이에 맞는 저장 공간 확보

  ```c
  char str[100];
  char* p;

  p=(char*)malloc(strlen(str)+1);
  strcpy(p, str);
  ```

  - 임시 배열에 문자열 입력 후 길이 계산
  - 널문자도 포함할 수 있도록 +1
  - 할당한 저장 공간에 입력한 문자열 복사
    > 포인터나 포인터 배열 → 자동 지역 변수로 선언 (쓰레기값)  
    >  포인터 배열 → 선언과 동시에 널 포인터로 초기화

- 명령행 인수 처리

  ```c
  int main(int argc, char** argv)
  {
  	int i;

  	for(i=0;i<argc;i++)
  	{
  		printf("%s\n", argv[i]);
  	}

  	return 0;
  }
  ```

  - `argc`: 명령행 문자열 수, `argv`: 명령행의 문자열
    - 명령행에서 프로그램을 실행시킬 때 프로그램의 이름과 필요한 정보를 함께 넘겨줌
    - 운영체제가 명령행 인수를 프로그램의 `main` 함수로 넘김
      → 포인터로 동적 할당한 영역을 배열처럼 사용가능
